#!/bin/bash

# exit on error
set -e

function deploy(){
	cat <<- EOF
	=====================RSTO DIGITAL=======================
	============ DEPLOIEMENT EN PROD =================
	==================================================

	EOF
	cat <<- EOF
	--------------------------------------------------
	  -------------- BUNDLE INSTALL ---------------
	--------------------------------------------------
	EOF
	bundle install --without development test 

	cat <<- EOF
	--------------------------------------------------
	  ------------ RUNNING MIGRATION -------------
	--------------------------------------------------
	EOF
	rails db:migrate

	cat <<- EOF
	--------------------------------------------------
	  -------------- NPM INSTALL ---------------
	--------------------------------------------------
	EOF
	npm install --only=prod --production

	cat <<- EOF
	--------------------------------------------------
	  ------------ RUNNING PRECOMPILE -------------
	--------------------------------------------------
	EOF
	rails assets:precompile 

	cat <<- EOF
	--------------------------------------------------
	  ------------ RESTARTING THE APPLICATION -------------
	--------------------------------------------------
	EOF
	bundle exec pumactl phased-restart      
}


deploy 